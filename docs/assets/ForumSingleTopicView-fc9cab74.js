import{_ as B,f as y,h as U,u as j,r as R,o as m,c as _,a,t as d,b as T,w as I,d as p,F as M,k as F,j as P,v as K,e as J,l as L}from"./index-91de8ff9.js";import{J as N,a as D,d as S,g as k,r as A,s as C,e as V,f as $,S as E}from"./index-3872b343.js";import{N as H}from"./NavBarComponent-98dacd08.js";const O="/MojPies/assets/send_h-38d532ee.png";const Y={components:{NavBarComponent:H},setup(){const i=y(""),n=y(),l=y(),e=r=>{const t=new Date(r.toMillis()),c=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),g=t.getFullYear(),u=String(t.getHours()).padStart(2,"0"),v=String(t.getMinutes()).padStart(2,"0");return`${c}.${s}.${g} ${u}:${v}`},w=async r=>{const t=await N(r);return{name:t.data().name,id:t.id}};U(async()=>{const r=j();l.value=`forum/${r.params.sectionKey}/threads/${r.params.threadId}`;let t;const c=await N(D(S,`forum/${r.params.sectionKey}/threads/${r.params.threadId}`)),s=c.data(),g=s.answers.map(async o=>{const h=await w(o.author);return await k(A(C,`images/${h.id}`)).then(b=>{t=b}).catch(b=>{t="/MojPies/profile.png"}),{date:o.date,answer:o.answer,authorName:h.name,authorId:h.id,imageSrc:t}}).sort((o,h)=>new Date(o.date)-new Date(h.date)),u=await w(s.authorRef);await k(A(C,`images/${u.id}`)).then(o=>{t=o}).catch(o=>{t="/MojPies/profile.png"});const v={id:c.id,threadTopic:s.topic,threadDescription:s.description,threadAuthor:u,threadAuthorImg:t,threadStartDate:s.date,answers:await Promise.all(g)};n.value=v});const x=async()=>{const r=D(S,l.value);if(V.currentUser){const c=V.currentUser.uid,s=D(S,"users",c);await $(r,{answers:E({answer:i.value,date:new Date,author:s})});var t=new Audio("/MojPies/bark.mp3");t.play(),i.value="",L.push({name:"forumThread",params:{sectionKey:route.params.sectionKey,threadId:route.params.threadId}}),window.location.reload()}};return{currentThread:n,formatDate:e,threadResponse:i,submitThreadResponse:async()=>{i.value.trim()!==""&&await x()},path:l}}},q={key:0,class:"container"},z={class:"card mb-3",style:{width:"100%"}},G={class:"card-body"},Q={class:"card-title"},W={class:"card-text"},X={class:"card-text"},Z=["src"],tt={class:"text-muted"},at={class:"card mb-3",style:{width:"100%"}},et={class:"card-body"},rt={class:"card-text"},st={class:"card-text"},ot=["src"],nt={class:"text-muted"},dt=a("hr",{class:"m-0"},null,-1),ct={class:"card mb-3",style:{width:"100%"}},it={class:"card-body"};function ht(i,n,l,e,w,x){const f=R("router-link"),r=R("NavBarComponent");return m(),_(M,null,[e.currentThread?(m(),_("div",q,[a("div",z,[a("div",G,[a("h5",Q,d(e.currentThread.threadTopic),1),a("p",W,d(e.currentThread.threadDescription),1),a("p",X,[T(f,{to:{name:"profile",params:{userId:e.currentThread.threadAuthor.id}}},{default:I(()=>[a("img",{src:e.currentThread.threadAuthorImg,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,Z),p(" "+d(e.currentThread.threadAuthor.name),1)]),_:1},8,["to"]),p(", "),a("small",tt,d(e.formatDate(e.currentThread.threadStartDate)),1)])])]),(m(!0),_(M,null,F(e.currentThread.answers,t=>(m(),_("div",at,[a("div",et,[a("p",rt,d(t.answer),1),a("p",st,[T(f,{to:{name:"profile",params:{userId:t.authorId}}},{default:I(()=>[a("img",{src:t.imageSrc,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,ot),p(" "+d(t.authorName),1)]),_:2},1032,["to"]),p(", "),a("small",nt,d(e.formatDate(t.date)),1)])]),dt]))),256)),a("div",ct,[a("div",it,[P(a("textarea",{"onUpdate:modelValue":n[0]||(n[0]=t=>e.threadResponse=t),class:"form-control w-100"},null,512),[[K,e.threadResponse]]),a("img",{class:"mt-3 d-block mx-auto",src:O,width:"150",onClick:n[1]||(n[1]=(...t)=>e.submitThreadResponse&&e.submitThreadResponse(...t))})])])])):J("",!0),T(r)],64)}const _t=B(Y,[["render",ht]]);export{_t as default};
