import{_ as S,o as m,c as u,a as t,f as $,u as V,h as j,n as O,r as D,F as N,k as R,b as E,w as T,d as W,t as k,i as F,e as C}from"./index-a9f1a630.js";import{J as I,a as w,d as x,g as b,r as A,s as B,e as y,f as M,S as P,D as Z}from"./index-3872b343.js";import{_ as G}from"./marker-00ef1fab.js";import{N as J}from"./NavBarComponent-6c623fb1.js";const q={props:{geolocation:{type:Array,required:!0}},mounted(){const c=L.map("mapa",{dragging:!1,scrollWheelZoom:!1,touchZoom:!1}).setView(this.geolocation,14);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(c);const s=L.marker(this.geolocation);var n=L.layerGroup(s,{icon:L.icon({iconUrl:"/src/assets/marker.png",iconSize:[5,5],iconAnchor:[25,25]})});n.addTo(c)}},Y={id:"mapa"},H=t("div",{id:"custom-icon",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","z-index":"9998"}},[t("img",{src:G,alt:"Custom Icon",class:"marker"})],-1),K=[H];function Q(c,s,n,e,o,d){return m(),u("div",Y,K)}const X=S(q,[["render",Q]]);const ee={setup(){const c=$(null),s=$(!1),n=$([]),e=V();j(async()=>{const i=(await I(w(x,`events/${e.params.key}`))).data(),p=i.attendees.map(a=>a.id),z=await Promise.all(i.attendees.map(async a=>{const _=await l(a);let v;return await b(A(B,`images/${a.id}`)).then(g=>{v=g}).catch(g=>{v="/src/assets/profile.png"}),{attendeeId:a.id,attendeeName:_.name,attendeeImgSrc:v}}));if(n.value=z,y.currentUser){c.value=y.currentUser.uid;const a=y.currentUser.uid;s.value=p.includes(a)}});async function o(){const p=(await I(w(x,`events/${e.params.key}`))).data().attendees.map(a=>a.id);if(console.log(p),y.currentUser){const a=y.currentUser.uid,_=w(x,"users",a),v=p.indexOf(_.id),g=w(x,"events",e.params.key);if(v===-1){const f=await l(_);await M(g,{attendees:P(_)}).then(async()=>{console.log("User added to attendees array"),s.value=!0;let h;await b(A(B,`images/${a}`)).then(U=>{h=U}).catch(U=>{h="/src/assets/profile.png"}),n.value.push({attendeeId:a,attendeeName:f.name,attendeeImgSrc:h})}).catch(h=>{console.error(h)})}else await M(g,{attendees:Z(_)}).then(()=>{console.log("User removed from attendees array"),s.value=!1,n.value=n.value.filter(f=>f.attendeeId!==a)}).catch(f=>{console.error(f)});var z=new Audio("/src/assets/bark.mp3");z.play()}}const d=O(()=>s.value?"/src/assets/leave.png":"/src/assets/join.png");async function l(r){const i=await I(r);return{name:i.data().name,id:i.id}}return{attendEvent:o,attendButtonSrc:d,attendeesData:n}}},te=t("p",{class:"small text-muted mt-3 mb-1"},"Uczestnicy",-1),ne=["src"],ae={key:1},se=t("em",null,"Nikt jeszcze nie dołączył",-1),oe=[se],re={class:"d-flex justify-content-center mt-3"},ce=["src"];function ie(c,s,n,e,o,d){const l=D("router-link");return m(),u(N,null,[te,e.attendeesData.length?(m(!0),u(N,{key:0},R(e.attendeesData,r=>(m(),u("div",null,[E(l,{to:{name:"profile",params:{userId:r.attendeeId}}},{default:T(()=>[t("img",{src:r.attendeeImgSrc,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,ne),W(" "+k(r.attendeeName),1)]),_:2},1032,["to"])]))),256)):(m(),u("p",ae,oe)),t("div",re,[t("img",{src:e.attendButtonSrc,width:"80",height:"80",onClick:s[0]||(s[0]=F(r=>e.attendEvent(),["prevent"]))},null,8,ce)])],64)}const de=S(ee,[["render",ie]]);const le={components:{MapComponent:X,EventAttendance:de,NavBarComponent:J},setup(){const c=$();j(async()=>{const n=V(),e=await I(w(x,`events/${n.params.key}`)),o=e.data(),d={id:e.id,type:o.type,description:o.description,location:o.location,date:o.date,geolocation:o.geolocation};c.value=d});function s(n){const e=new Date(n.toMillis()),o=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],d=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],l=o[e.getDay()],r=e.getDate(),i=d[e.getMonth()],p=e.getFullYear();return`${l}, ${r} ${i} ${p}`}return{formatDate:s,currentEvent:c}}},me={key:0,class:"event-details-container",style:{"margin-bottom":"50px"}},ue={class:"top-container d-flex justify-content-center align-items-center flex-column"},pe=["src"],_e={class:"mt-3 text-center"},ve={class:"details-container me-3"},ge=t("p",{class:"small text-muted mb-1"},"Gdzie i kiedy?",-1),fe=t("p",{class:"small text-muted mt-3 mb-1"},"Opis",-1),he={class:"d-flex justify-content-center mt-3"},ye={key:0,class:"map-wrapper"};function ke(c,s,n,e,o,d){const l=D("MapComponent"),r=D("EventAttendance"),i=D("NavBarComponent");return m(),u(N,null,[e.currentEvent?(m(),u("div",me,[t("div",ue,[t("img",{src:e.currentEvent.type==="Spacer"?"/src/assets/dogWalk2.png":"/src/assets/dogTraining.png",class:"img-fluid",style:{"max-width":"70%"}},null,8,pe),t("h3",_e,k(e.currentEvent.type),1)]),t("div",ve,[ge,t("h5",null,k(e.currentEvent.location)+",",1),t("h6",null,k(e.formatDate(e.currentEvent.date)),1),fe,t("p",null,k(e.currentEvent.description),1)]),t("div",he,[e.currentEvent.geolocation?(m(),u("div",ye,[E(l,{geolocation:e.currentEvent.geolocation},null,8,["geolocation"])])):C("",!0)]),E(r)])):C("",!0),E(i)],64)}const Ee=S(le,[["render",ke]]);export{Ee as default};
