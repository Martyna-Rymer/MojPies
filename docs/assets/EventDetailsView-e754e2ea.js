import{_ as I,o as m,c as u,a as t,e as D,u as A,f as B,j as V,r as E,F as j,m as O,b as M,w as R,d as W,t as w,k as F,g as N}from"./index-fc604969.js";import{J as S,b as $,d as x,g as b,r as C,s as U,a as k,f as P,S as T,D as Z}from"./index-ce0dfd1e.js";import{_ as J}from"./marker-00ef1fab.js";import{N as q}from"./NavBarComponent-a77b1a2f.js";const G={props:{geolocation:{type:Array,required:!0}},mounted(){const c=L.map("mapa",{dragging:!1,scrollWheelZoom:!1,touchZoom:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(c),c.setView(this.geolocation,14)}},H={id:"mapa"},Y=t("div",{id:"custom-icon",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -100%)","z-index":"999"}},[t("img",{src:J,alt:"Custom Icon",class:"marker"})],-1),K=[Y];function Q(c,r,a,e,o,d){return m(),u("div",H,K)}const X=I(G,[["render",Q]]);const ee={setup(){const c=D(null),r=D(!1),a=D([]),e=A();B(async()=>{const i=(await S($(x,`events/${e.params.key}`))).data(),p=i.attendees.map(n=>n.id),g=await Promise.all(i.attendees.map(async n=>{const _=await l(n);let v;return await b(C(U,`images/${n.id}`)).then(f=>{v=f}).catch(f=>{v="/MojPies/profile.png"}),{attendeeId:n.id,attendeeName:_.name,attendeeImgSrc:v}}));if(a.value=g,k.currentUser){c.value=k.currentUser.uid;const n=k.currentUser.uid;r.value=p.includes(n)}});async function o(){const p=(await S($(x,`events/${e.params.key}`))).data().attendees.map(n=>n.id);if(console.log(p),k.currentUser){const n=k.currentUser.uid,_=$(x,"users",n),v=p.indexOf(_.id),f=$(x,"events",e.params.key);if(v===-1){const h=await l(_);await P(f,{attendees:T(_)}).then(async()=>{console.log("User added to attendees array"),r.value=!0;let y;await b(C(U,`images/${n}`)).then(z=>{y=z}).catch(z=>{y="/MojPies/profile.png"}),a.value.push({attendeeId:n,attendeeName:h.name,attendeeImgSrc:y})}).catch(y=>{console.error(y)})}else await P(f,{attendees:Z(_)}).then(()=>{console.log("User removed from attendees array"),r.value=!1,a.value=a.value.filter(h=>h.attendeeId!==n)}).catch(h=>{console.error(h)});var g=new Audio("/MojPies/bark.mp3");g.play()}}const d=V(()=>r.value?"/MojPies/leave.png":"/MojPies/join.png");async function l(s){const i=await S(s);return{name:i.data().name,id:i.id}}return{attendEvent:o,attendButtonSrc:d,attendeesData:a}}},te=t("p",{class:"small text-muted mt-3 mb-1"},"Uczestnicy",-1),ne=["src"],ae={key:1},oe=t("em",null,"Nikt jeszcze nie dołączył",-1),se=[oe],re={class:"d-flex justify-content-center mt-3"},ce=["src"];function ie(c,r,a,e,o,d){const l=E("router-link");return m(),u(j,null,[te,e.attendeesData.length?(m(!0),u(j,{key:0},O(e.attendeesData,s=>(m(),u("div",null,[M(l,{to:{name:"profile",params:{userId:s.attendeeId}}},{default:R(()=>[t("img",{src:s.attendeeImgSrc,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,ne),W(" "+w(s.attendeeName),1)]),_:2},1032,["to"])]))),256)):(m(),u("p",ae,se)),t("div",re,[t("img",{src:e.attendButtonSrc,width:"80",height:"80",onClick:r[0]||(r[0]=F(s=>e.attendEvent(),["prevent"]))},null,8,ce)])],64)}const de=I(ee,[["render",ie]]);const le={components:{MapComponent:X,EventAttendance:de,NavBarComponent:q},setup(){const c=D();B(async()=>{const a=A(),e=await S($(x,`events/${a.params.key}`)),o=e.data(),d={id:e.id,type:o.type,description:o.description,location:o.location,date:o.date,geolocation:o.geolocation};c.value=d});function r(a){const e=new Date(a.toMillis()),o=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],d=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],l=o[e.getDay()],s=e.getDate(),i=d[e.getMonth()],p=e.getFullYear(),g=e.getHours(),n=e.getMinutes();return`${l}, ${s} ${i} ${p} ${g.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}return{formatDate:r,currentEvent:c}}},me={key:0,class:"event-details-container",style:{"margin-bottom":"50px"}},ue={class:"top-container d-flex justify-content-center align-items-center flex-column"},pe=["src"],_e={class:"mt-3 text-center"},ge={class:"details-container me-3"},ve=t("p",{class:"small text-muted mb-1"},"Gdzie i kiedy?",-1),fe=t("p",{class:"small text-muted mt-3 mb-1"},"Opis",-1),he=t("p",{class:"small text-muted mb-1"},"Miejsce spotkania",-1),ye={class:"d-flex justify-content-center mt-3"},ke={key:0,class:"map-wrapper"};function we(c,r,a,e,o,d){const l=E("MapComponent"),s=E("EventAttendance"),i=E("NavBarComponent");return m(),u(j,null,[e.currentEvent?(m(),u("div",me,[t("div",ue,[t("img",{src:e.currentEvent.type==="Spacer"?"/MojPies/dogWalk.png":"/MojPies/dogTraining.png",class:"img-fluid",style:{"max-width":"70%"}},null,8,pe),t("h3",_e,w(e.currentEvent.type),1)]),t("div",ge,[ve,t("h5",null,w(e.currentEvent.location)+",",1),t("h6",null,w(e.formatDate(e.currentEvent.date)),1),fe,t("p",null,w(e.currentEvent.description),1),he]),t("div",ye,[e.currentEvent.geolocation?(m(),u("div",ke,[M(l,{geolocation:e.currentEvent.geolocation},null,8,["geolocation"])])):N("",!0)]),M(s)])):N("",!0),M(i)],64)}const Me=I(le,[["render",we]]);export{Me as default};
