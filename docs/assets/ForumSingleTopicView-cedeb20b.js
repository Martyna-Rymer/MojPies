import{_ as j,f as w,h as B,u as U,r as k,o as g,c as f,a as r,t as h,b as y,w as C,d as v,F as P,k as F,j as K,v as $,e as J}from"./index-fa1f1d08.js";import{J as S,a as T,d as b,g as x,r as R,s as M,e as V,f as L,S as q}from"./index-3872b343.js";import{N as E}from"./NavBarComponent-1d67f165.js";const H="/MojPies/assets/send_h-38d532ee.png";const O={components:{NavBarComponent:E},setup(){const c=w(""),i=w(),p=w(),t=w([]),N=a=>{const e=new Date(a.toMillis()),o=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear(),l=String(e.getHours()).padStart(2,"0"),u=String(e.getMinutes()).padStart(2,"0");return`${o}.${s}.${n} ${l}:${u}`},D=async a=>{const e=await S(a);return{name:e.data().name,id:e.id}};B(async()=>{const a=U();p.value=`forum/${a.params.sectionKey}/threads/${a.params.threadId}`;let e;const o=await S(T(b,`forum/${a.params.sectionKey}/threads/${a.params.threadId}`)),s=o.data(),n=s.answers.map(async d=>{const m=await D(d.author);return await x(R(M,`images/${m.id}`)).then(I=>{e=I}).catch(I=>{e="/MojPies/profile.png"}),{date:d.date,answer:d.answer,authorName:m.name,authorId:m.id,imageSrc:e}}).sort((d,m)=>new Date(d.date)-new Date(m.date)),l=await D(s.authorRef);await x(R(M,`images/${l.id}`)).then(d=>{e=d}).catch(d=>{e="/MojPies/profile.png"});const u={id:o.id,threadTopic:s.topic,threadDescription:s.description,threadAuthor:l,threadAuthorImg:e,threadStartDate:s.date,answers:await Promise.all(n)};i.value=u,t.value=await Promise.all(n)});const _=async()=>{const a=T(b,p.value);if(V.currentUser){const o=V.currentUser.uid,s=T(b,"users",o);await L(a,{answers:q({answer:c.value,date:new Date,author:s})});var e=new Audio("/MojPies/bark.mp3");e.play();let n;await x(R(M,`images/${o}`)).then(u=>{n=u}).catch(u=>{n="/MojPies/profile.png"});let l=await S(s);t.value.push({date:new Date,answer:c.value,authorName:l.name,authorId:o,imageSrc:n}),c.value=""}};return{currentThread:i,formatDate:N,threadResponse:c,submitThreadResponse:async()=>{c.value.trim()!==""&&await _()},path:p,threadAnswers:t}}},Y={class:"card mb-3",style:{width:"100%"}},z={class:"card-body"},G={class:"card-title"},Q={class:"card-text"},W={class:"card-text"},X=["src"],Z={class:"text-muted"},aa={class:"card mb-3",style:{width:"100%"}},ta={class:"card-body"},ea={class:"card-text"},ra={class:"card-text"},sa=["src"],oa={class:"text-muted"},na=r("hr",{class:"m-0"},null,-1),da={class:"card mb-3",style:{width:"100%"}},ca={class:"card-body"};function ia(c,i,p,t,N,D){const _=k("router-link"),A=k("NavBarComponent");return g(),f(P,null,[t.currentThread?(g(),f("div",{class:"container",key:c.uniqueKey},[r("div",Y,[r("div",z,[r("h5",G,h(t.currentThread.threadTopic),1),r("p",Q,h(t.currentThread.threadDescription),1),r("p",W,[y(_,{to:{name:"profile",params:{userId:t.currentThread.threadAuthor.id}}},{default:C(()=>[r("img",{src:t.currentThread.threadAuthorImg,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,X),v(" "+h(t.currentThread.threadAuthor.name),1)]),_:1},8,["to"]),v(", "),r("small",Z,h(t.formatDate(t.currentThread.threadStartDate)),1)])])]),(g(!0),f(P,null,F(t.threadAnswers,a=>(g(),f("div",aa,[r("div",ta,[r("p",ea,h(a.answer),1),r("p",ra,[y(_,{to:{name:"profile",params:{userId:a.authorId}}},{default:C(()=>[r("img",{src:a.imageSrc,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,sa),v(" "+h(a.authorName),1)]),_:2},1032,["to"]),v(", "),r("small",oa,h(t.formatDate(a.date)),1)])]),na]))),256)),r("div",da,[r("div",ca,[K(r("textarea",{"onUpdate:modelValue":i[0]||(i[0]=a=>t.threadResponse=a),class:"form-control w-100"},null,512),[[$,t.threadResponse]]),r("img",{class:"mt-3 d-block mx-auto",src:H,width:"150",onClick:i[1]||(i[1]=(...a)=>t.submitThreadResponse&&t.submitThreadResponse(...a))})])])])):J("",!0),y(A)],64)}const ma=j(O,[["render",ia]]);export{ma as default};
