import{_ as z,o as m,c as u,a as t,e as $,u as A,f as B,n as V,r as D,F as j,l as O,b as E,w as R,d as W,t as w,j as F,g as C}from"./index-b903597e.js";import{J as I,b as k,d as x,g as S,r as U,s as b,a as y,f as P,S as T,D as Z}from"./index-ce0dfd1e.js";import{_ as J}from"./marker-00ef1fab.js";import{N as q}from"./NavBarComponent-db693a88.js";const G={props:{geolocation:{type:Array,required:!0}},mounted(){const c=L.map("mapa",{dragging:!1,scrollWheelZoom:!1,touchZoom:!1});L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(c),c.setView(this.geolocation,14)}},Y={id:"mapa"},H=t("div",{id:"custom-icon",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -100%)","z-index":"999"}},[t("img",{src:J,alt:"Custom Icon",class:"marker"})],-1),K=[H];function Q(c,r,a,e,o,d){return m(),u("div",Y,K)}const X=z(G,[["render",Q]]);const ee={setup(){const c=$(null),r=$(!1),a=$([]),e=A();B(async()=>{const i=(await I(k(x,`events/${e.params.key}`))).data(),p=i.attendees.map(n=>n.id),M=await Promise.all(i.attendees.map(async n=>{const _=await l(n);let v;return await S(U(b,`images/${n.id}`)).then(f=>{v=f}).catch(f=>{v="/MojPies/profile.png"}),{attendeeId:n.id,attendeeName:_.name,attendeeImgSrc:v}}));if(a.value=M,y.currentUser){c.value=y.currentUser.uid;const n=y.currentUser.uid;r.value=p.includes(n)}});async function o(){const p=(await I(k(x,`events/${e.params.key}`))).data().attendees.map(n=>n.id);if(console.log(p),y.currentUser){const n=y.currentUser.uid,_=k(x,"users",n),v=p.indexOf(_.id),f=k(x,"events",e.params.key);if(v===-1){const g=await l(_);await P(f,{attendees:T(_)}).then(async()=>{console.log("User added to attendees array"),r.value=!0;let h;await S(U(b,`images/${n}`)).then(N=>{h=N}).catch(N=>{h="/MojPies/profile.png"}),a.value.push({attendeeId:n,attendeeName:g.name,attendeeImgSrc:h})}).catch(h=>{console.error(h)})}else await P(f,{attendees:Z(_)}).then(()=>{console.log("User removed from attendees array"),r.value=!1,a.value=a.value.filter(g=>g.attendeeId!==n)}).catch(g=>{console.error(g)});var M=new Audio("/MojPies/bark.mp3");M.play()}}const d=V(()=>r.value?"/MojPies/leave.png":"/MojPies/join.png");async function l(s){const i=await I(s);return{name:i.data().name,id:i.id}}return{attendEvent:o,attendButtonSrc:d,attendeesData:a}}},te=t("p",{class:"small text-muted mt-3 mb-1"},"Uczestnicy",-1),ne=["src"],ae={key:1},oe=t("em",null,"Nikt jeszcze nie dołączył",-1),se=[oe],re={class:"d-flex justify-content-center mt-3"},ce=["src"];function ie(c,r,a,e,o,d){const l=D("router-link");return m(),u(j,null,[te,e.attendeesData.length?(m(!0),u(j,{key:0},O(e.attendeesData,s=>(m(),u("div",null,[E(l,{to:{name:"profile",params:{userId:s.attendeeId}}},{default:R(()=>[t("img",{src:s.attendeeImgSrc,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,ne),W(" "+w(s.attendeeName),1)]),_:2},1032,["to"])]))),256)):(m(),u("p",ae,se)),t("div",re,[t("img",{src:e.attendButtonSrc,width:"80",height:"80",onClick:r[0]||(r[0]=F(s=>e.attendEvent(),["prevent"]))},null,8,ce)])],64)}const de=z(ee,[["render",ie]]);const le={components:{MapComponent:X,EventAttendance:de,NavBarComponent:q},setup(){const c=$();B(async()=>{const a=A(),e=await I(k(x,`events/${a.params.key}`)),o=e.data(),d={id:e.id,type:o.type,description:o.description,location:o.location,date:o.date,geolocation:o.geolocation};c.value=d});function r(a){const e=new Date(a.toMillis()),o=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],d=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],l=o[e.getDay()],s=e.getDate(),i=d[e.getMonth()],p=e.getFullYear();return`${l}, ${s} ${i} ${p}`}return{formatDate:r,currentEvent:c}}},me={key:0,class:"event-details-container",style:{"margin-bottom":"50px"}},ue={class:"top-container d-flex justify-content-center align-items-center flex-column"},pe=["src"],_e={class:"mt-3 text-center"},ve={class:"details-container me-3"},fe=t("p",{class:"small text-muted mb-1"},"Gdzie i kiedy?",-1),ge=t("p",{class:"small text-muted mt-3 mb-1"},"Opis",-1),he={class:"d-flex justify-content-center mt-3"},ye={key:0,class:"map-wrapper"};function we(c,r,a,e,o,d){const l=D("MapComponent"),s=D("EventAttendance"),i=D("NavBarComponent");return m(),u(j,null,[e.currentEvent?(m(),u("div",me,[t("div",ue,[t("img",{src:e.currentEvent.type==="Spacer"?"/MojPies/dogWalk.png":"/MojPies/dogTraining.png",class:"img-fluid",style:{"max-width":"70%"}},null,8,pe),t("h3",_e,w(e.currentEvent.type),1)]),t("div",ve,[fe,t("h5",null,w(e.currentEvent.location)+",",1),t("h6",null,w(e.formatDate(e.currentEvent.date)),1),ge,t("p",null,w(e.currentEvent.description),1)]),t("div",he,[e.currentEvent.geolocation?(m(),u("div",ye,[E(l,{geolocation:e.currentEvent.geolocation},null,8,["geolocation"])])):C("",!0)]),E(s)])):C("",!0),E(i)],64)}const Ee=z(le,[["render",we]]);export{Ee as default};
