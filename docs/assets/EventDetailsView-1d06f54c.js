import{_ as j,o as m,c as u,a as t,f as $,u as A,h as B,n as V,r as D,F as M,k as O,b as E,w as R,d as T,t as k,i as W,e as S}from"./index-d3e46547.js";import{J as I,a as w,d as x,g as U,r as C,s as b,e as y,f as P,S as F,D as Z}from"./index-3872b343.js";import{_ as G}from"./marker-00ef1fab.js";import{N as J}from"./NavBarComponent-900ccc1e.js";const q={props:{geolocation:{type:Array,required:!0}},mounted(){const c=L.map("mapa",{dragging:!1,scrollWheelZoom:!1,touchZoom:!1}).setView(this.geolocation,14);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(c);const o=L.marker(this.geolocation);var n=L.layerGroup(o,{icon:L.icon({iconUrl:"/src/assets/marker.png",iconSize:[5,5],iconAnchor:[25,25]})});n.addTo(c)}},Y={id:"mapa"},H=t("div",{id:"custom-icon",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)","z-index":"9998"}},[t("img",{src:G,alt:"Custom Icon",class:"marker"})],-1),K=[H];function Q(c,o,n,e,s,d){return m(),u("div",Y,K)}const X=j(q,[["render",Q]]);const ee={setup(){const c=$(null),o=$(!1),n=$([]),e=A();B(async()=>{const i=(await I(w(x,`events/${e.params.key}`))).data(),p=i.attendees.map(a=>a.id),z=await Promise.all(i.attendees.map(async a=>{const _=await l(a);let v;return await U(C(b,`images/${a.id}`)).then(g=>{v=g}).catch(g=>{v="/MojPies/profile.png"}),{attendeeId:a.id,attendeeName:_.name,attendeeImgSrc:v}}));if(n.value=z,y.currentUser){c.value=y.currentUser.uid;const a=y.currentUser.uid;o.value=p.includes(a)}});async function s(){const p=(await I(w(x,`events/${e.params.key}`))).data().attendees.map(a=>a.id);if(console.log(p),y.currentUser){const a=y.currentUser.uid,_=w(x,"users",a),v=p.indexOf(_.id),g=w(x,"events",e.params.key);if(v===-1){const f=await l(_);await P(g,{attendees:F(_)}).then(async()=>{console.log("User added to attendees array"),o.value=!0;let h;await U(C(b,`images/${a}`)).then(N=>{h=N}).catch(N=>{h="/MojPies/profile.png"}),n.value.push({attendeeId:a,attendeeName:f.name,attendeeImgSrc:h})}).catch(h=>{console.error(h)})}else await P(g,{attendees:Z(_)}).then(()=>{console.log("User removed from attendees array"),o.value=!1,n.value=n.value.filter(f=>f.attendeeId!==a)}).catch(f=>{console.error(f)});var z=new Audio("/MojPies/bark.mp3");z.play()}}const d=V(()=>o.value?"/MojPies/leave.png":"/MojPies/join.png");async function l(r){const i=await I(r);return{name:i.data().name,id:i.id}}return{attendEvent:s,attendButtonSrc:d,attendeesData:n}}},te=t("p",{class:"small text-muted mt-3 mb-1"},"Uczestnicy",-1),ne=["src"],ae={key:1},oe=t("em",null,"Nikt jeszcze nie dołączył",-1),se=[oe],re={class:"d-flex justify-content-center mt-3"},ce=["src"];function ie(c,o,n,e,s,d){const l=D("router-link");return m(),u(M,null,[te,e.attendeesData.length?(m(!0),u(M,{key:0},O(e.attendeesData,r=>(m(),u("div",null,[E(l,{to:{name:"profile",params:{userId:r.attendeeId}}},{default:R(()=>[t("img",{src:r.attendeeImgSrc,class:"user-avatar rounded-circle",alt:"User avatar"},null,8,ne),T(" "+k(r.attendeeName),1)]),_:2},1032,["to"])]))),256)):(m(),u("p",ae,se)),t("div",re,[t("img",{src:e.attendButtonSrc,width:"80",height:"80",onClick:o[0]||(o[0]=W(r=>e.attendEvent(),["prevent"]))},null,8,ce)])],64)}const de=j(ee,[["render",ie]]);const le={components:{MapComponent:X,EventAttendance:de,NavBarComponent:J},setup(){const c=$();B(async()=>{const n=A(),e=await I(w(x,`events/${n.params.key}`)),s=e.data(),d={id:e.id,type:s.type,description:s.description,location:s.location,date:s.date,geolocation:s.geolocation};c.value=d});function o(n){const e=new Date(n.toMillis()),s=["Niedziela","Poniedziałek","Wtorek","Środa","Czwartek","Piątek","Sobota"],d=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],l=s[e.getDay()],r=e.getDate(),i=d[e.getMonth()],p=e.getFullYear();return`${l}, ${r} ${i} ${p}`}return{formatDate:o,currentEvent:c}}},me={key:0,class:"event-details-container",style:{"margin-bottom":"50px"}},ue={class:"top-container d-flex justify-content-center align-items-center flex-column"},pe=["src"],_e={class:"mt-3 text-center"},ve={class:"details-container me-3"},ge=t("p",{class:"small text-muted mb-1"},"Gdzie i kiedy?",-1),fe=t("p",{class:"small text-muted mt-3 mb-1"},"Opis",-1),he={class:"d-flex justify-content-center mt-3"},ye={key:0,class:"map-wrapper"};function ke(c,o,n,e,s,d){const l=D("MapComponent"),r=D("EventAttendance"),i=D("NavBarComponent");return m(),u(M,null,[e.currentEvent?(m(),u("div",me,[t("div",ue,[t("img",{src:e.currentEvent.type==="Spacer"?"/MojPies/dogWalk.png":"/MojPies/dogTraining.png",class:"img-fluid",style:{"max-width":"70%"}},null,8,pe),t("h3",_e,k(e.currentEvent.type),1)]),t("div",ve,[ge,t("h5",null,k(e.currentEvent.location)+",",1),t("h6",null,k(e.formatDate(e.currentEvent.date)),1),fe,t("p",null,k(e.currentEvent.description),1)]),t("div",he,[e.currentEvent.geolocation?(m(),u("div",ye,[E(l,{geolocation:e.currentEvent.geolocation},null,8,["geolocation"])])):S("",!0)]),E(r)])):S("",!0),E(i)],64)}const Ee=j(le,[["render",ke]]);export{Ee as default};
